KISSY.add("app/views/manage/jifen/my",function(a,e,t,i,s,n,l){var d=i.all;return function(a){return a.prototype.template='<div class=jifen-container> <div class=jifen-nav> <div class=left> <ul class=float> <li class=current> <a href="#!/manage/jifen/my">\u6211\u7684\u79ef\u5206</a> </li> <li> <a href="#!/manage/jifen/detail">\u79ef\u5206\u660e\u7ec6</a> </li> </ul> </div> <div class=right> <ul class=float> <li>\u6765\u6e90\uff1a{{source}}</li> <li>\u7ad9\u70b9\uff1a{{sitename}}</li> </ul> </div> </div> <div class=detail-bar> <div> <span class=per-detail>\u79ef\u5206\u603b\u91cf\uff1a<span class=jifen_total>{{total}}</span></span> <span class=per-detail>\u79ef\u5206\u5269\u4f59\u603b\u91cf\uff1a<span class=jifen_remainder>{{remainderTotal}}</span></span> </div> <div> <span class=per-detail>\u79ef\u5206\u5df2\u53d1\u653e\u603b\u91cf\uff1a<span class=jifen_gave>{{gaveTotal}}</span></span> <span class=per-detail>\u79ef\u5206\u5931\u6548\u603b\u91cf\uff1a<span class=jifen_invalid>{{invalidTotal}}</span></span> </div> </div> <div class=srch-bar> <form class=J_Form> <span>\u79ef\u5206\u521b\u5efa\u65f6\u95f4</span><input value="{{startTime}}" class="J_Calendar J_start"> <span>\u79ef\u5206\u5931\u6548\u65f6\u95f4</span><input value="{{endTime}}" class="J_Calendar J_end"> <a class="srch-btn btn" mx-click=search>\u641c\u7d22</a> <button class=new-jifen type=button mx-click=createfen>\u65b0\u5efa\u79ef\u5206</button> </form> </div> <div class="table-content table-container"> <table class=table> <thead> <tr {{^list}}class=no-data{{/list}}> <th class=left width="8%"></th> <th class=left width="10%">\u79ef\u5206ID</th> <th class=left width="10%">\u79ef\u5206\u603b\u91cf</th> <th class=left width="17%">\u79ef\u5206\u521b\u5efa\u65f6\u95f4</th> <th class=left width="13%">\u5269\u4f59\u79ef\u5206</th> <th class=left width="17%">\u79ef\u5206\u5931\u6548\u65f6\u95f4</th> <th class=left width="10%">\u72b6\u6001</th> <th class=left width=auto></th> </tr> </thead> </table> <table class=table bx-name="tables" bx-tmpl="list" bx-datakey="list"> <tbody> {{#list}} <tr> <td width="8%" class=left> <input class="J_check {{{list_hide}}}" type=checkbox mx-click="checkInput{id:{{id}}}"> </td> <td width="10%" class="left jifen-id" id="{{id}}">{{id}}</td> <td width="10%" class=left>{{gave}}</td> <td width="17%" class=left>{{gmtCreate}}</td> <td width="13%" class=left><span class=red>{{remainder}}</span></td> <td width="17%" class=left>{{gmtEnd}}</td> <td width="10%" class=left>{{{list_status}}}</td> <td width=auto class=left>{{{list_opt}}}</td> </tr> {{/list}} {{^list}} <tr class=none> <td colspan=8>\u6682\u65e0\u6570\u636e</td> </tr> {{/list}} </tbody> </table> <div class=tfoot> <div id=J_item_pagination class=pagination> <div class=pagination-left> <input class=J_disable_all type=checkbox mx-click="checkInput{id:-1}}"> <span>\u5168\u90e8</span> <a class=btn mx-click=disableAll>\u505c\u6b62\u53d1\u653e</a> </div> <div class=pagination-pages> <div class=pagination-page><span class=page-simply>{{currentPage}}/{{totalPage}}</span></div> <div class=pagination-count><span>\u5171</span><span class=b>{{totalPage}}</span><span>\u9875</span></div> <div class=pagination-form> <span>\u5411\u7b2c</span><input class=page-num value="{{currentPage}}" name=page type=text><span>\u9875</span> <a class="btn-jump btn btn-size25" mx-click=jump>\u8df3\u8f6c</a> </div> </div> </div> </div> </div> </div>',a}(e.extend({locationChange:function(){this.render()},render:function(e){var i,s=this,n=s.location;if(e)i=e;else{var i=a.clone(n.params);i.pageNum=i.pageNum?i.pageNum:1,i.startTime=i.startTime?i.startTime:"",i.endTime=i.endTime?i.endTime:""}a.mix(i,{bizType:bizType,pageSize:10}),s.manage(t.fetchAll([{name:"jifen_list",urlParams:i}],function(a,e){var t=e.get("data").result,n=t.list;s.setViewPagelet({source:t.source,sitename:t.siteName,total:t.total,remainderTotal:t.remainderTotal,gaveTotal:t.gaveTotal,invalidTotal:t.invalidTotal,list:n,totalPage:t.totalPage,currentPage:t.currentPage,startTime:i.startTime,endTime:i.endTime},function(){s.components()},function(){}),d("#J_item_pagination").one(".page-simply").html(t.currentPage+"/"+t.totalPage),d("#J_item_pagination").one(".b").html(t.totalPage),d("#J_item_pagination").one(".page-num").val(t.currentPage),d(".jifen_total").html(t.total),d(".jifen_remainder").html(t.remainderTotal),d(".jifen_gave").html(t.gaveTotal),d(".jifen_invalid").html(t.invalidTotal)}))},components:function(){a.each(d(".J_Calendar"),function(a){var e=new l({trigger:a,align:{points:["bl","tl"],offset:[0,0]},popup:!0,triggerType:["click"]});e.on("select",function(t){e.hide();var i=l.Date.format(t.date,"yyyy-mm-dd");d(a).val(i)})})},search:function(a){var e=this,t=d(".J_start").val(),i=d(".J_end").val(),a=a;e.render({pageNum:a,startTime:t,endTime:i})},"jump<click>":function(a){a.halt();var e=parseInt(d(".page-num").val()),t=parseInt(d("#J_item_pagination").one(".b").html());e&&0/0!=e&&(0>=e||e>t||(d("#J_item_pagination").one(".page-simply").html(e+"/"+t),this.search(e)))},"checkInput<click>":function(e){var t=this,i=e.domEvent;d(i.target).hasClass("J_disable_all")?(d(".J_check").prop("checked",d(i.target).prop("checked")),d(i.target).prop("checked")?(t.disableIds="",a.each(d(".jifen-id"),function(a){d(a).parent("tr").one(".J_check").hasClass("hidden")||(t.disableIds+=","+d(a).attr("id"))})):t.disableIds=""):d(i.target).prop("checked")?(t.disableIds||(t.disableIds=""),t.disableIds=t.disableIds+","+e.params.id,t.disableIds.split(",").length==d(".J_check").length-d(".J_check.hidden").length+1&&d(".J_disable_all").prop("checked",!0)):(d(".J_disable_all").prop("checked",!1),t.disableIds=t.disableIds.replace(","+e.params.id,""))},"disableAll<click>":function(a){a.halt();var e=this;if(e.disableIds&&""!=e.disableIds&&","!=e.disableIds){var i=parseInt(d(a.domEvent.target).offset().top)-180,s=n.getDefaultDialogConfig({width:300,top:i}),l="app/views/util/confirm",c={confirmFn:function(){e.manage(t.fetchAll([{name:"disable_jifen",urlParams:{batchIds:e.disableIds.slice(1),bizType:bizType}}],function(a,t){var i=t.get("data");i.status?(n.hideDialog(),e.render()):n.showGlobalTip(i.message)}),function(){})},cancelFn:function(){n.hideDialog()},confirmTitle:"\u505c\u6b62\u53d1\u653e",confirmContent:"\u60a8\u786e\u5b9a\u8981\u505c\u6b62\u53d1\u653e\u5417\uff1f"};n.showDialog(s,l,c)}},"search<click>":function(a){a.halt();var e=this;e.search(1)},"addJifen<click>":function(a){a.halt();var e=this,i=new s.Dialog({mask:!1,prefixCls:"jifen-",headerContent:"\u589e\u52a0\u79ef\u5206",bodyContent:"<div class='jd-content'><div class='jd-per'><span style='font-weight:700;color:#000;'>\u79ef\u5206ID:"+a.params.id+"</span></div><div class='jd-per'><span>\u65b0\u589e\u79ef\u5206\u6570\u91cf\uff1a</span><input placeholder='\u8f93\u5165\u6574\u6570' class='jd-input'><span style='color:#fd3f00;margin-left:10px;'>*\u521b\u5efa\u4fe1\u606f\u4e0d\u53ef\u66f4\u6539</span></div><div class='jd-opt'><div class='jd-per'><button class='jd-sure' style='float:right'>\u786e\u5b9a</button></div></div></div>",closable:!0,closeAction:"destroy","with":355});i.render(),d(i.get("el")).one(".jifen-ext-close-x").html("X"),i.center(),i.show(),d(i.get("el")).one(".jd-sure").on("click",function(){var s=d(i.get("el")).one(".jd-input").val();return s?/^[0-9]*[1-9][0-9]*$/.test(s)?void e.manage(t.fetchAll([{name:"add_jifen",urlParams:{batchId:a.params.id,number:d(i.get("el")).one(".jd-input").val(),bizType:bizType}}],function(a,t){var s=t.get("data");s.status?(i.destroy(),e.render()):n.showGlobalTip(s.message)}),function(){}):void n.showGlobalTip("\u65b0\u589e\u79ef\u5206\u6570\u91cf\u5fc5\u987b\u662f\u6b63\u6574\u6570\uff01"):void n.showGlobalTip("\u589e\u52a0\u79ef\u5206\u5fc5\u987b\u586b\u5199\u65b0\u589e\u79ef\u5206\u6570\u91cf\uff01")})},showdate:function(a,e){var t=new Date(e-0+864e5*a);return t=t.getFullYear()+"/"+(t.getMonth()+1)+"/"+t.getDate(),new Date(t)},"createfen<click>":function(a){a.halt();var e=this;if(e.dialog)e.dialog.show();else{var i=new s.Dialog({mask:!1,prefixCls:"jifen-",headerContent:"\u65b0\u5efa\u79ef\u5206",bodyContent:"<div class='jd-content'><div class='jd-per'><span>\u65b0\u5efa\u79ef\u5206\u6570\u91cf\uff1a</span><input placeholder='\u8f93\u5165\u6574\u6570' class='jd-input jd-amount'></div><div class='jd-per'><span>\u505c\u6b62\u53d1\u653e\u65f6\u95f4\uff1a</span><input placeholder='\u9009\u62e9\u65f6\u95f4' class='jd-input jd-calendar'></div><div class='jd-opt'><p>*\u521b\u5efa\u4fe1\u606f\u4e0d\u53ef\u66f4\u6539</p><div class='jd-per'><span>\u505c\u6b62\u53d1\u653e\u65f6\u95f4\u662f\u6307\u622a\u6b62\u8be5\u65f6\u95f4\u8be5\u6279\u79ef\u5206\u505c\u6b62\u53d1\u653e</span><button class='jd-sure'>\u786e\u5b9a</button></div></div></div>",closable:!0,closeAction:"hide","with":400});i.render(),d(i.get("el")).one(".jifen-ext-close-x").html("X"),i.center(),i.show(),e.dialog=i;var c=new l({minDate:e.showdate(1,new Date),trigger:d(i.get("el")).one(".jd-calendar"),align:{points:["bl","tl"],offset:[0,0]},popup:!0,triggerType:["click"]});c.on("select",function(a){c.hide();var e=l.Date.format(a.date,"yyyy-mm-dd");d(i.get("el")).one(".jd-calendar").val(e)}),d(i.get("el")).one(".jd-sure").on("click",function(){var a=d(i.get("el")).one(".jd-amount").val(),s=d(i.get("el")).one(".jd-calendar").val();return a&&s?/^[0-9]*[1-9][0-9]*$/.test(a)?void e.manage(t.fetchAll([{name:"create_jifen",urlParams:{number:a,endTime:s,bizType:bizType}}],function(a,t){var s=t.get("data");s.status?(i.hide(),e.render()):n.showGlobalTip(s.message)}),function(){}):void n.showGlobalTip("\u65b0\u5efa\u79ef\u5206\u6570\u91cf\u5fc5\u987b\u662f\u6b63\u6574\u6570\uff01"):void n.showGlobalTip("\u65b0\u5efa\u79ef\u5206\u5fc5\u987b\u586b\u5199\u65b0\u5efa\u79ef\u5206\u6570\u91cf\u548c\u505c\u6b62\u53d1\u653e\u65f6\u95f4\uff01")})}},renderer:{list:{hide:function(){switch(this.status){case"\u53d1\u653e\u4e2d":return"";default:return"hidden"}},status:function(){switch(this.status){case"\u53d1\u653e\u4e2d":return this.status;default:return'<span class="gray">'+this.status+"</span>"}},opt:function(){switch(this.status){case"\u53d1\u653e\u4e2d":return'<a mx-click="addJifen{id:'+this.id+'}">\u589e\u52a0\u79ef\u5206</a>';default:return""}}}}}))},{requires:["mxext/view","app/models/modelmanager","node","overlay","app/util/util","brix/gallery/calendar/"]});